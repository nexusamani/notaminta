<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nota Minta SK Cherating</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .page-container { max-width: 900px; margin: 20px auto; background: white; padding: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 8px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #374151; }
        input, select { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #d1d5db; padding: 8px; text-align: left; }
        th { background-color: #f9fafb; }
        .btn { padding: 10px 20px; color: white; border-radius: 4px; cursor: pointer; font-weight: bold; border: none; }
        .btn-add { background-color: #10b981; }
        .btn-pdf { background-color: #ef4444; }
        .btn-excel { background-color: #22c55e; }
        .btn-remove { background-color: #ef4444; color: white; padding: 2px 8px; font-size: 12px; }
        
        /* Style khas untuk logo di paparan web */
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 20px;
        }
        .school-logo {
            width: 80px;
            height: auto;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="page-container">
    
    <div class="logo-container">
        <img src="logo_sekolah.jpg" alt="Logo Sekolah" class="school-logo" id="imgLogo">
        <h1 class="text-2xl font-bold text-blue-900 text-center">NOTA MINTA SK CHERATING</h1>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div>
            <label>No. Rujukan:</label>
            <div class="flex items-center">
                <span class="bg-gray-200 p-2 border border-r-0 rounded-l">SKCRTG.300-3/1/1 (</span>
                <input type="text" id="refNoInput" class="rounded-l-none rounded-r-none border-l-0 border-r-0 text-center" placeholder="...">
                <span class="bg-gray-200 p-2 border border-l-0 rounded-r">)</span>
            </div>
        </div>
        <div>
            <label>Tarikh:</label>
            <input type="date" id="dateInput">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div>
            <label>Kepada:</label>
            <textarea readonly class="bg-gray-100 h-24">Guru Besar,
SK Cherating,
26080 Kuantan, Pahang</textarea>
        </div>
        <div>
            <label>Daripada (Kategori):</label>
            <select id="fromDropdown">
                <option value="Ketua Panitia Subjek Teras">Ketua Panitia Subjek Teras</option>
                <option value="Subjek Elektif">Subjek Elektif</option>
                <option value="Bimbingan dan Kaunseling">Bimbingan dan Kaunseling</option>
            </select>
        </div>
    </div>

    <div class="mb-6 border-t border-b py-4 bg-gray-50 p-4">
        <label>Tajuk Permohonan:</label>
        <div class="flex items-center gap-2">
            <span>PERMOHONAN MENDAPATKAN BEKALAN PERALATAN BAGI TAHUN</span>
            <select id="yearDropdown" class="w-32"></select>
        </div>
        <p class="text-sm text-gray-600 mt-2">Berhubung dengan perkara di atas, diharap dapat tuan meluluskan permohonan mendapatkan bekalan seperti berikut:</p>
    </div>

    <div class="mb-6 overflow-x-auto">
        <table id="itemTable">
            <thead>
                <tr>
                    <th style="width: 5%">Bil</th>
                    <th style="width: 35%">Perihal Barang</th>
                    <th style="width: 10%">Kuantiti</th>
                    <th style="width: 15%">Harga/Unit (RM)</th>
                    <th style="width: 15%">Jumlah (RM)</th>
                    <th style="width: 15%">Tarikh Diperlukan</th>
                    <th style="width: 5%">Hapus</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <button onclick="addRow()" class="mt-2 btn btn-add text-sm">+ Tambah Item</button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 bg-blue-50 p-4 rounded">
        <div>
            <label>Peruntukan:</label>
            <input list="allocationOptions" id="allocationInput" placeholder="Pilih atau taip sendiri...">
            <datalist id="allocationOptions">
                <option value="BANTUAN PERKAPITA M/PELAJARAN">
                <option value="BANTUAN SUKAN">
                <option value="BANTUAN KOKURIKULUM">
                <option value="BANTUAN BIMBINGAN KAUNSELING">
            </datalist>
        </div>
        <div>
            <label>Baki Peruntukan Semasa (RM):</label>
            <input type="number" id="balanceInput" step="0.01" placeholder="0.00">
        </div>
        <div>
             <label>Subsidiari/Mata Pelajaran Semasa:</label>
             <input type="text" id="subsidiaryInput" placeholder="Contoh: BAHASA INGGERIS">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8 border-t pt-4">
        <div>
            <h3 class="font-bold border-b mb-2">Pemohon</h3>
            <label>Nama Pemohon:</label>
            <select id="applicantName"></select>
            
            <label class="mt-2">Jawatan:</label>
            <select id="applicantPosition">
                <option value="Ketua Panitia Subjek Teras">Ketua Panitia Subjek Teras</option>
                <option value="Subjek Elektif">Subjek Elektif</option>
                <option value="Bimbingan dan Kaunseling">Bimbingan dan Kaunseling</option>
            </select>
        </div>
        <div>
            <h3 class="font-bold border-b mb-2">Kelulusan</h3>
            <label>Nama:</label>
            <input type="text" value="ASRI BIN MOHAMED" readonly class="bg-gray-100">
            <label class="mt-2">Jawatan:</label>
            <input type="text" value="Guru Besar" readonly class="bg-gray-100">
            <label class="mt-2">Tarikh Kelulusan:</label>
            <input type="date" id="approvalDate">
        </div>
    </div>

    <div class="flex gap-4 justify-center">
        <button onclick="generatePDF()" class="btn btn-pdf flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
            Jana PDF
        </button>
        <button onclick="generateExcel()" class="btn btn-excel flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
            Jana Excel
        </button>
    </div>
    
    <div class="mt-8 text-xs text-gray-500 border-t pt-2">
        <p>Rujukan Dokumen:</p>
        <p>SKCRTG.300-3/1/1 ( ) - Perolehan Alat Tulis dan Bekalan Pejabat</p>
        <p>SKCRTG.300-3/1/2 ( ) - Perolehan Bahan Mentah (Makanan)</p>
        <p>SKCRTG.300-2/1/1 ( ) - Perolehan Harta Modal dan Aset Bernilai Rendah</p>
    </div>

</div>

<script>
    // Data Senarai Nama Guru
    const teachers = [
        "AMIRAH BINTI CHE AZUHA", "AZLAN BIN DAUD", "AZLINA BINTI HANAPI", "AMANI BINTI AWANG QAMARULDEEN",
        "ANWAR SHAFIQ BIN JAMALUDIN", "ANIS SYAZWANI BINTI MAT ISA", "BAHJATU SHOLIHAH BINTI RAMAN",
        "FAZILAH BINTI MUDA", "HANIS AYUNI BINTI HADI", "MAKTAR BIN MOHAMED", "MOHD AFIZU BIN ADENAN",
        "MUHAMAD HAKIMI BIN AMER", "MUHAMMAD SAUFI FIRDAUS BIN SABUDIN", "NURAZIZAH BINTI OMAR",
        "NOOR IDAYU BINTI ISMAIL", "NOOR AIN BINTI MOHD YUSOFF", "NOR HUDA DHAMIRAH BINTI ISA",
        "NUR IDAYU BINTI ABDULL ROZAK", "NOR NAZAHIYAH BINTI NASARUDIN", "NOR SHAZIRA BINTI AZIZ",
        "NOR SYAZALIAH BINTI MAT RADZI", "NURIN IZZAH BINTI ROSMAN", "NUR FATIHATULHUSNA BINTI YA'ACOB",
        "NURUL ADILLAH BINTI ZAKARIA", "NURUL IZZATI BINTI MUHAMMAD NAZIR", "NUR ZAKIAH BINTI ZAINUDDIN",
        "RAJIAH BINTI HAJI MUHAMMAD", "RAMLAH BINTI HASSAN", "RAZIAH BINTI WAHAB",
        "RAUDZAH BINTI HAJI KAMALUDIN", "RASHIDAH BINTI ZULKIFLI", "ROSHANIDA BINTI ROHANUDDIN",
        "SITI ZURAIHA BINTI MAPOL", "SUHAIDA BINTI SIDEK", "SUHAIMI BIN ISMAIL",
        "SUZIMARLIANA BINTI IBRAHIM", "SYAIMA' BINTI ABDUL HALIM@BAKAR", "UMMI FARAH BINTI ALIAS",
        "WAN SITI NOR ADILAH BINTI WAN OTHMAN", "WAN NOOR UMMI BINTI W.RAMLI", "ZURAYA BINTI OTHMAN",
        "ZIRATUL ASYIKIN BINTI MUSA", "ZAILATUL ROZAIDI BIN ZAKARIA"
    ];

    window.onload = function() {
        // Set Default Date
        document.getElementById('dateInput').valueAsDate = new Date();
        document.getElementById('approvalDate').valueAsDate = new Date();

        // Populate Years (2026 - 2100)
        const yearSelect = document.getElementById('yearDropdown');
        for (let y = 2026; y <= 2100; y++) {
            let opt = document.createElement('option');
            opt.value = y;
            opt.innerHTML = y;
            yearSelect.appendChild(opt);
        }

        // Populate Names
        const nameSelect = document.getElementById('applicantName');
        teachers.sort().forEach(name => {
            let opt = document.createElement('option');
            opt.value = name;
            opt.innerHTML = name;
            nameSelect.appendChild(opt);
        });

        // Add 5 initial rows
        for(let i=0; i<5; i++) addRow();
    };

    function addRow() {
        const table = document.getElementById('itemTable').getElementsByTagName('tbody')[0];
        const rowCount = table.rows.length + 1;
        const row = table.insertRow();
        
        row.innerHTML = `
            <td class="text-center">${rowCount}</td>
            <td><input type="text" class="desc" placeholder="Nama Barang"></td>
            <td><input type="number" class="qty" oninput="calcRow(this)" placeholder="0"></td>
            <td><input type="number" class="price" oninput="calcRow(this)" step="0.01" placeholder="0.00"></td>
            <td><input type="text" class="total bg-gray-50" readonly placeholder="0.00"></td>
            <td><input type="date" class="reqDate"></td>
            <td class="text-center"><button onclick="removeRow(this)" class="btn-remove">X</button></td>
        `;
    }

    function removeRow(btn) {
        const row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
        renumberRows();
    }

    function renumberRows() {
        const table = document.getElementById('itemTable').getElementsByTagName('tbody')[0];
        for (let i = 0; i < table.rows.length; i++) {
            table.rows[i].cells[0].innerText = i + 1;
        }
    }

    function calcRow(input) {
        const row = input.parentNode.parentNode;
        const qty = parseFloat(row.querySelector('.qty').value) || 0;
        const price = parseFloat(row.querySelector('.price').value) || 0;
        const total = qty * price;
        row.querySelector('.total').value = total.toFixed(2);
    }

    function formatDate(dateStr) {
        if (!dateStr) return "";
        const parts = dateStr.split('-');
        return `${parts[2]}.${parts[1]}.${parts[0]}`; 
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // --- LOGO HANDLING ---
        // Cuba masukkan logo ke dalam PDF
        const imgElement = document.getElementById('imgLogo');
        const logoWidth = 25; // lebar dalam mm di PDF
        const logoHeight = 25; // tinggi dalam mm di PDF
        
        // Kira posisi tengah
        const pageWidth = doc.internal.pageSize.getWidth();
        const logoX = (pageWidth - logoWidth) / 2;
        
        try {
            // Kita lukis imej dulu jika ia berjaya dimuatkan di browser
            if (imgElement.complete && imgElement.naturalHeight !== 0) {
                 doc.addImage(imgElement, 'JPEG', logoX, 10, logoWidth, logoHeight);
            }
        } catch (e) {
            console.log("Logo gagal dimuatkan ke PDF (mungkin isu CORS atau fail tiada). Teruskan tanpa logo.");
        }

        // Anjakkan teks ke bawah sedikit sebab ada logo
        let startY = 40; 

        // Data Extraction
        const refNo = `SKCRTG.300-3/1/1 (${document.getElementById('refNoInput').value})`;
        const date = formatDate(document.getElementById('dateInput').value);
        const fromCat = document.getElementById('fromDropdown').value;
        const year = document.getElementById('yearDropdown').value;
        const allocation = document.getElementById('allocationInput').value;
        const balance = document.getElementById('balanceInput').value;
        const subsidiary = document.getElementById('subsidiaryInput').value;
        const applicantName = document.getElementById('applicantName').value;
        const applicantPos = document.getElementById('applicantPosition').value;
        const approvalDate = formatDate(document.getElementById('approvalDate').value);

        // Header Text
        doc.setFontSize(14);
        doc.setFont("helvetica", "bold");
        doc.text("NOTA MINTA", 14, startY);
        
        doc.setFontSize(10);
        doc.setFont("helvetica", "normal");
        
        doc.text(`No Ruj: ${refNo}`, 120, startY);
        doc.text(`Tarikh: ${date}`, 120, startY + 5);

        doc.setFont("helvetica", "bold");
        doc.text("KEPADA   : GURU BESAR", 14, startY + 15);
        doc.setFont("helvetica", "normal");
        doc.text("SK CHERATING, 26080, KUANTAN PAHANG", 35, startY + 20);
        
        doc.setFont("helvetica", "bold");
        doc.text(`DARIPADA : ${fromCat.toUpperCase()}`, 14, startY + 30);

        doc.setFontSize(11);
        doc.setFont("helvetica", "bold");
        doc.text(`PERMOHONAN MENDAPATKAN BEKALAN PERALATAN BAGI TAHUN ${year}`, 14, startY + 40);
        
        doc.setFontSize(10);
        doc.setFont("helvetica", "normal");
        doc.text("Berhubung dengan perkara di atas, diharap dapat tuan meluluskan permohonan", 14, startY + 47);
        doc.text("mendapatkan bekalan seperti berikut :", 14, startY + 52);

        // Table
        const tableRows = [];
        const tbody = document.getElementById('itemTable').getElementsByTagName('tbody')[0];
        for (let i = 0; i < tbody.rows.length; i++) {
            const row = tbody.rows[i];
            tableRows.push([
                row.cells[0].innerText,
                row.querySelector('.desc').value,
                row.querySelector('.qty').value,
                row.querySelector('.price').value,
                row.querySelector('.total').value,
                formatDate(row.querySelector('.reqDate').value),
                ''
            ]);
        }

        doc.autoTable({
            startY: startY + 55,
            head: [['BIL', 'PERIHAL BARANG', 'KUANTITI', 'HARGA / UNIT', 'ANGGARAN HARGA', 'TARIKH DIPERLUKAN', 'CATATAN OLEH GURU BESAR']],
            body: tableRows,
            theme: 'grid',
            styles: { fontSize: 8, cellPadding: 2 },
            headStyles: { fillColor: [220, 220, 220], textColor: 0, fontStyle: 'bold' }
        });

        let finalY = doc.lastAutoTable.finalY + 10;

        // Footer
        doc.text(`Peruntukan: ${allocation}`, 14, finalY);
        doc.text(`Subsidiari/Mata Pelajaran Semasa: ${subsidiary}`, 14, finalY + 5);
        doc.text(`Baki Peruntukan Semasa: RM ${balance}`, 14, finalY + 10);

        doc.text("Sekian, terima kasih.", 14, finalY + 20);
        doc.text("Permohonan di atas", 130, finalY + 20);
        doc.text("Diluluskan / Tidak diluluskan", 130, finalY + 25);

        doc.text("Yang Benar,", 14, finalY + 30);

        const signY = finalY + 50;
        doc.line(14, signY, 80, signY); 
        doc.line(130, signY, 190, signY); 

        doc.setFont("helvetica", "bold");
        doc.text(applicantName, 14, signY + 5);
        doc.text("ASRI BIN MOHAMED", 130, signY + 5);
        
        doc.setFont("helvetica", "normal");
        doc.text(applicantPos, 14, signY + 10);
        doc.text("Guru Besar", 130, signY + 10);
        
        doc.text("SK Cherating", 14, signY + 15);
        doc.text("SK Cherating", 130, signY + 15);
        
        doc.text(`Tarikh: ${date}`, 14, signY + 20);
        doc.text(`Tarikh: ${approvalDate}`, 130, signY + 20);

        const refY = signY + 30;
        doc.setFontSize(8);
        doc.text("*No Ruj Nota Minta:", 14, refY);
        doc.text("SKCRTG.300-3/1/1 (        ) - Perolehan Alat Tulis dan Bekalan Pejabat", 14, refY + 5);
        doc.text("SKCRTG.300-3/1/2 (        ) - Perolehan Bahan Mentah (Makanan)", 14, refY + 10);
        doc.text("SKCRTG.300-2/1/1 (        ) - Perolehan Harta Modal dan Aset Bernilai Rendah", 14, refY + 15);

        doc.save(`Nota_Minta_${document.getElementById('refNoInput').value}.pdf`);
    }

    function generateExcel() {
        const wb = XLSX.utils.book_new();
        const ws_data = [];

        ws_data.push(["NOTA MINTA SK CHERATING"]);
        ws_data.push(["", "", "No Ruj:", `SKCRTG.300-3/1/1 (${document.getElementById('refNoInput').value})`]);
        ws_data.push(["", "", "Tarikh:", formatDate(document.getElementById('dateInput').value)]);
        ws_data.push(["KEPADA", ": GURU BESAR"]);
        ws_data.push(["", "SK CHERATING, 26080, KUANTAN PAHANG"]);
        ws_data.push([]);
        ws_data.push(["DARIPADA", ": " + document.getElementById('fromDropdown').value]);
        ws_data.push([]);
        ws_data.push(["PERMOHONAN MENDAPATKAN BEKALAN PERALATAN BAGI TAHUN " + document.getElementById('yearDropdown').value]);
        ws_data.push([]);
        ws_data.push(["Berhubung dengan perkara di atas, diharap dapat tuan meluluskan permohonan"]);
        ws_data.push(["mendapatkan bekalan seperti berikut :"]);
        ws_data.push([]);
        
        ws_data.push(["BIL", "PERIHAL BARANG", "KUANTITI", "HARGA / UNIT", "ANGGARAN HARGA", "TARIKH DIPERLUKAN", "CATATAN OLEH GURU BESAR"]);

        const tbody = document.getElementById('itemTable').getElementsByTagName('tbody')[0];
        for (let i = 0; i < tbody.rows.length; i++) {
            const row = tbody.rows[i];
            ws_data.push([
                row.cells[0].innerText,
                row.querySelector('.desc').value,
                row.querySelector('.qty').value,
                row.querySelector('.price').value,
                row.querySelector('.total').value,
                formatDate(row.querySelector('.reqDate').value),
                ""
            ]);
        }

        ws_data.push([]);
        ws_data.push(["Peruntukan:", document.getElementById('allocationInput').value]);
        ws_data.push(["Subsidiari/Mata Pelajaran Semasa:", document.getElementById('subsidiaryInput').value]);
        ws_data.push(["Baki Peruntukan Semasa : RM", document.getElementById('balanceInput').value]);
        ws_data.push([]);
        ws_data.push(["Sekian, terima kasih.", "", "Permohonan di atas"]);
        ws_data.push(["", "", "Diluluskan / Tidak diluluskan"]);
        ws_data.push(["Yang Benar,"]);
        ws_data.push([]);
        ws_data.push([document.getElementById('applicantName').value, "", "ASRI BIN MOHAMED"]);
        ws_data.push([document.getElementById('applicantPosition').value, "", "Guru Besar"]);
        ws_data.push(["SK Cherating", "", "SK Cherating"]);
        ws_data.push(["Tarikh: " + formatDate(document.getElementById('dateInput').value), "", "Tarikh : " + formatDate(document.getElementById('approvalDate').value)]);

        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        XLSX.utils.book_append_sheet(wb, ws, "Nota Minta");
        XLSX.writeFile(wb, "Nota_Minta_SKC.xlsx");
    }
</script>

</body>
</html>
